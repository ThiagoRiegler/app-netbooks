<!DOCTYPE html>
<html>

	<head>
	
		<title>Registro material informatico</title>
		<link rel="stylesheet" type="text/css" href="style.css">
		<meta charset="utf-8">

	</head>
	
	<body>

		<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>

		<script type="module">//Conecta con la base de datos
			import {initializeApp} from 'https://www.gstatic.com/firebasejs/9.9.0/firebase-app.js';

			const firebaseConfig = {
				apiKey: "AIzaSyArhMpapnmPnHMqsr-DWF_iVfVW5ZOncoA",
				authDomain: "ematp-cdd6d.firebaseapp.com",
				databaseURL: "https://ematp-cdd6d-default-rtdb.firebaseio.com",
				projectId: "ematp-cdd6d",
				storageBucket: "ematp-cdd6d.appspot.com",
				messagingSenderId: "601799982600",
				appId: "1:601799982600:web:e1e5af5e5d1b82aa3b5bbd",
				measurementId: "G-TJYNE66YGH"
			};

			firebase.initializeApp(firebaseConfig);

			//Muestra los datos en una tabla
			var db = firebase.database();
			var ref = db.ref("MarcelaProjectX");
					     
			var table = document.getElementById("tabla");
					    
			//limpia la tabla
			table.innerHTML = "";
					 
			//con esta funci√≥n recorre todos los datos almacenados en FB ordenados por mi child(tipo)    
			ref.orderByChild("fecha").on("child_added", function(snapshot){

			//repite el proceso como cuantas referencias encuentre y los asigna a la lista "d" 
			var d = snapshot.val();        
					        
			{
				var row = table.insertRow(0);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				var cell5 = row.insertCell(4);
				var cell6 = row.insertCell(5);
				var cell7 = row.insertCell(6);
				var cell8 = row.insertCell(7);
				var cell9 = row.insertCell(8);

				// asigna a las celdas el valir del Child especificado
				cell1.innerHTML = d.fecha;
				cell2.innerHTML = d.hora;
				cell3.innerHTML = d.cargo;
				cell4.innerHTML = d.nombre;
				cell5.innerHTML = d.curso;
				cell6.innerHTML = d.PC;
				cell8.innerHTML = d.estado;
				cell9.innerHTML = '<button type="button" onclick="devolver(${doc.fecha})">Devuelto</button>';

			}
			 
			});		
			
		</script>

		<script>	

			function ConsultaFecha(fecha){	

				const q = query(collection(db, "cities"), where("capital", "==", true));

				const querySnapshot = getDocs(q);

					{
						var row = table.insertRow(0);
						var cell1 = row.insertCell(0);
						var cell2 = row.insertCell(1);
						var cell3 = row.insertCell(2);
						var cell4 = row.insertCell(3);
						var cell5 = row.insertCell(4);
						var cell6 = row.insertCell(5);
						var cell7 = row.insertCell(6);
						var cell8 = row.insertCell(7);
						var cell9 = row.insertCell(8);

						// asigna a las celdas el valir del Child especificado
						cell1.innerHTML = datos.fecha;
						cell2.innerHTML = datos.hora;
						cell3.innerHTML = datos.cargo;
						cell4.innerHTML = datos.nombre;
						cell5.innerHTML = datos.curso;
						cell6.innerHTML = datos.PC;
						cell8.innerHTML = datos.estado;
						cell9.innerHTML = '<button type="button" onclick="devolver(${doc.fecha})">Devuelto</button>';
					}

			}

		</script>


		<h1>Registro material informatico</h1>
		
		<form>
			
			<input type="date" name="fecha" id="fecha"><br>
			<input type="button" value="Buscar" onclick="ConsultaFecha(fecha)">

		</form>

		<div>
			<table>
		    	<thead>
		        	<tr>
		            	<th>Fecha</th>
		            	<th>Hora</th>
		                <th>Cargo</th>
		            	<th>Nombre y apellido</th>
		            	<th>Curso</th>
		                <th>PCs</th>
		                <th>Fecha de devolucion</th>
		                <th>Estado</th>    
		                <th></th>                                
		            </tr>
		     	</thead>
		    	<tbody id="tabla">                                
		    	</tbody>
		</div>


	</body>

</html>
